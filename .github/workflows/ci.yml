name: Continuous Integration

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: ðŸ§¹ RTL Linter
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install Verilator
        run: sudo apt-get update && sudo apt-get install -y verilator
      - name: Run Linter on all RTL files
        run: |
          echo "Linting all project files..."
          INCLUDE_PATHS="-Irtl/peripherals -Irtl/components -Irtl/arithmetic"
          find rtl/ -name "*.sv" -print0 | while IFS= read -r -d $'\0' file; do
            echo "Checking $file..."
            verilator --lint-only -sv ${INCLUDE_PATHS} "$file" || exit 1
          done
          echo "Linting passed."

  verify:
    name: ðŸ”¬ Simulation Verification
    needs: lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install Verilator
        run: sudo apt-get update && sudo apt-get install -y verilator
      - name: Run Verification Script
        run: |
          chmod +x ./verification/scripts/run_all_tests.sh
          ./verification/scripts/run_all_tests.sh