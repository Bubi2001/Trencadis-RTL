# Nombre del workflow general
name: Continuous Integration

# Disparadores (los mismos para ambos jobs)
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# DefiniciÃ³n de los trabajos que componen el workflow
jobs:
  # --- TRABAJO 1: LINTER ---
  # Un trabajo rÃ¡pido que solo comprueba la sintaxis y el estilo del cÃ³digo.
  lint:
    name: ðŸ§¹ RTL Linter
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Verilator
        run: sudo apt-get update && sudo apt-get install -y verilator

      - name: Run Linter on all RTL files
        run: |
          echo "Linting all project files..."
          INCLUDE_PATHS="-Irtl/peripherals -Irtl/components -Irtl/arithmetic"
          find rtl/ -name "*.sv" -print0 | while IFS= read -r -d $'\0' file; do
            echo "Checking $file..."
            verilator --lint-only -sv ${INCLUDE_PATHS} "$file" || exit 1
          done
          echo "Linting passed."

  # --- TRABAJO 2: VERIFICACIÃ“N (SIMULACIÃ“N) ---
  # Un trabajo mÃ¡s lento que ejecuta todos los testbenches.
  verify:
    name: ðŸ”¬ Simulation Verification
    # Â¡La lÃ­nea clave! Este trabajo solo empezarÃ¡ si el job 'lint' ha terminado con Ã©xito.
    needs: lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Verilator
        run: sudo apt-get update && sudo apt-get install -y verilator

      - name: Run Verification Script
        run: |
          chmod +x ./verification/scripts/run_all_tests.sh
          ./verification/scripts/run_all_tests.sh